var WeixinApi=function(){return{version:"1.8",ready:function(b){if(b&&"function"==typeof b){var a=this,c=function(){b(a)};"undefined"==typeof window.WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",c,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",c),document.attachEvent("onWeixinJSBridgeReady",c)):c()}},shareToTimeline:function(b,a){a=a||{};var c=function(b){WeixinJSBridge.invoke("shareTimeline",{appid:b.appId?b.appId:"",img_url:b.imgUrl,
link:b.link,desc:b.title,title:b.desc,img_width:"120",img_height:"120"},function(b){switch(b.err_msg){case "share_timeline:cancel":a.cancel&&a.cancel(b);break;case "share_timeline:fail":a.fail&&a.fail(b);break;case "share_timeline:confirm":case "share_timeline:ok":a.confirm&&a.confirm(b)}a.all&&a.all(b)})};WeixinJSBridge.on("menu:share:timeline",function(d){a.async&&a.ready?(window._wx_loadedCb_=a.dataLoaded||new Function,0<window._wx_loadedCb_.toString().indexOf("_wx_loadedCb_")&&(window._wx_loadedCb_=
new Function),a.dataLoaded=function(a){window._wx_loadedCb_(a);c(a)},a.ready&&a.ready(d)):(a.ready&&a.ready(d),c(b))})},shareToWeibo:function(b,a){a=a||{};var c=function(b){WeixinJSBridge.invoke("shareWeibo",{content:b.desc,url:b.link},function(b){switch(b.err_msg){case "share_weibo:cancel":a.cancel&&a.cancel(b);break;case "share_weibo:fail":a.fail&&a.fail(b);break;case "share_weibo:confirm":case "share_weibo:ok":a.confirm&&a.confirm(b)}a.all&&a.all(b)})};WeixinJSBridge.on("menu:share:weibo",function(d){a.async&&
a.ready?(window._wx_loadedCb_=a.dataLoaded||new Function,0<window._wx_loadedCb_.toString().indexOf("_wx_loadedCb_")&&(window._wx_loadedCb_=new Function),a.dataLoaded=function(a){window._wx_loadedCb_(a);c(a)},a.ready&&a.ready(d)):(a.ready&&a.ready(d),c(b))})},shareToFriend:function(b,a){a=a||{};var c=function(b){WeixinJSBridge.invoke("sendAppMessage",{appid:b.appId?b.appId:"",img_url:b.imgUrl,link:b.link,desc:b.desc,title:b.title,img_width:"120",img_height:"120"},function(b){switch(b.err_msg){case "send_app_msg:cancel":a.cancel&&
a.cancel(b);break;case "send_app_msg:fail":a.fail&&a.fail(b);break;case "send_app_msg:confirm":case "send_app_msg:ok":a.confirm&&a.confirm(b)}a.all&&a.all(b)})};WeixinJSBridge.on("menu:share:appmessage",function(d){a.async&&a.ready?(window._wx_loadedCb_=a.dataLoaded||new Function,0<window._wx_loadedCb_.toString().indexOf("_wx_loadedCb_")&&(window._wx_loadedCb_=new Function),a.dataLoaded=function(a){window._wx_loadedCb_(a);c(a)},a.ready&&a.ready(d)):(a.ready&&a.ready(d),c(b))})},showOptionMenu:function(){WeixinJSBridge.call("showOptionMenu")},
hideOptionMenu:function(){WeixinJSBridge.call("hideOptionMenu")},showToolbar:function(){WeixinJSBridge.call("showToolbar")},hideToolbar:function(){WeixinJSBridge.call("hideToolbar")},getNetworkType:function(b){b&&"function"==typeof b&&WeixinJSBridge.invoke("getNetworkType",{},function(a){b(a.err_msg)})},imagePreview:function(b,a){b&&a&&0!=a.length&&WeixinJSBridge.invoke("imagePreview",{current:b,urls:a})},closeWindow:function(){WeixinJSBridge.call("closeWindow")}}}();var LB={random:function(b,a){return Math.floor(Math.random()*(a-b+1)+b)}};window.onload=function(){cc.game.onStart=function(){cc.Director._getInstance().setDisplayStats(!1);cc.view.adjustViewPort(!0);cc.sys.isMobile?cc.view.setDesignResolutionSize(320,480,cc.ResolutionPolicy.FIXED_WIDTH):cc.view.setDesignResolutionSize(320,480,cc.ResolutionPolicy.SHOW_ALL);cc.view.resizeWithBrowserSize(!0);cc.director.runScene(new LB.StartupScene)};cc.game.run("game_canvas")};var cc=cc||{},LB=LB||{},WeixinApi=WeixinApi||{};LB.share_msg="\u6211\u6b63\u5728\u73a9 Line Boost\uff0c\u6839\u672c\u505c\u4e0d\u4e0b\u6765\uff01";LB.share_data={};LB.share_data.total_games=0;LB.call_php=function(b){var a=document.createElement("script");a.type="text/javascript";a.src=b;document.body.appendChild(a)};
WeixinApi.ready(function(b){var a={appId:"",imgUrl:window.location.href+"res/icon.png",link:window.location.href,desc:"",title:"Line Boost"},c={ready:function(){a.desc=LB.share_msg},cancel:function(a){},fail:function(a){},confirm:function(a){LB.call_php("php/share_stat.php?time="+LB.share_data.time+"&score="+LB.share_data.score+"&total_games="+LB.share_data.total_games)},all:function(a){}};b.shareToFriend(a,c);b.shareToTimeline(a,c);b.shareToWeibo(a,c)});cc=cc||{};LB=LB||{};LB.steplen=100;LB.dataPosToGLPos=function(b){return cc.pMult(b,LB.steplen)};LB.Track=cc.DrawNode.extend({tournants:null,lastTournant:null,themeColour:cc.color(255,255,255),appendTournant:function(b,a){var c=LB.dataPosToGLPos(cc.p(b,a));null!==this.lastTournant&&this.drawSegment(this.lastTournant,c,5,this.themeColour);this.drawDot(c,10,this.themeColour);this.lastTournant=c;this.tournants.push(cc.p(b,a))},setThemeColour:function(b){this.themeColour=b}});
LB.Track.create=function(b){var a=new LB.Track;b&&a.setThemeColour(b);a.tournants=[];return a};cc=cc||{};LB=LB||{};
LB.StartupScene=cc.Scene.extend({onEnter:function(){this._super();var b=cc.director.getWinSize(),a=cc.LabelTTF.create("Line Boost","",58);a.setPosition(b.width/2,.8*b.height);this.addChild(a);var c=cc.LabelTTF.create("\u731b\u6233\u5f00\u59cb","",36);c.setPosition(b.width/2,.4*b.height);c.setOpacity(0);this.addChild(c);c.runAction(cc.Sequence.create(cc.DelayTime.create(1),cc.FadeIn.create(1.59375),cc.CallFunc.create(function(){c.runAction(cc.RepeatForever.create(cc.Sequence.create(cc.FadeTo.create(1.2,192),
cc.FadeTo.create(1.2,255))))})));a=cc.LabelTTF.create("Rev 19","",28);a.setAnchorPoint(cc.p(0,0));a.setPosition(cc.p(0,20));this.addChild(a);a=cc.LabelTTF.create("\u5f3a\u529b\u5916\u63f4: Cocos2d-x HTML5","",20);a.setColor(cc.color(128,128,255));a.setAnchorPoint(cc.p(.5,0));a.setPosition(cc.p(b.width/2,0));this.addChild(a);cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(a,b){cc.director.runScene(cc.TransitionFade.create(1,new LB.TutorialScene,cc.color(0,
0,0)));return!0}},this)}});cc=cc||{};LB=LB||{};cc.pEqual=function(b,a){return b.x===a.x&&b.y===a.y};LB.direction_towards=function(b,a){for(var c=0;4>c;c++)if(cc.pEqual(LB.board.move[c],cc.pSub(a,b)))return c};LB.control_button_images=["res/turn.png","res/straight.png","res/straight.png","res/turn.png"];
LB.control_button=function(b,a){var c=cc.MenuItemImage.create(LB.control_button_images[b],LB.control_button_images[b],function(){a(b)});c.setAnchorPoint(cc.p(0,0));c.setPosition(cc.p(80*b,0));c.setOpacity(0);c=cc.Menu.create(c);c.setPosition(cc.p(0,0));return c};LB.control_button_sprite=function(b){var a=cc.Sprite.create(LB.control_button_images[b]);a.setAnchorPoint(cc.p(0,0));a.setPosition(cc.p(80*b,0));a.setFlippedX(2<=b);return a};LB.gameTime=20;
LB.pointsPerGeneration=60;
LB.GameScene=cc.Scene.extend({onEnter:function(){this._super();var b=cc.director.getWinSize(),a=this;this.endGame=function(a){for(var b=0;4>b;b++)this.getChildByTag(10880+b).setEnabled(!1);this.unschedule(k);this.addChild(LB.GameOverDialogue.create(a,LB.gameTime-d,g),1E3)};var c=cc.LabelTTF.create("00","",48);c.setPosition(b.width/2,.9*b.height);c.setColor(cc.color(64,255,64));this.addChild(c,100);var d=LB.gameTime,f=cc.LabelTTF.create(d.toFixed(1).toString()+" s","",36);f.setPosition(b.width/
2,.8*b.height);f.setColor(cc.color(64,255,64));this.addChild(f,100);var k=function(a){d-=a;f.setString(d.toFixed(1).toString()+" s");0>d&&(d=0,this.endGame("Time up!!"))},e=LB.Track.create();e.appendTournant(0,0);e.setPosition(b.width/2,b.height/2);this.addChild(e);var h=LB.Track.create();h.themeColour=cc.color(0,128,255);h.appendTournant(0,0);e.addChild(h);var q=LB.board.direction.UP,p=cc.p(-200,0),n=[cc.p(-1,0),cc.p(0,0)];LB.board.used=[];var r=function(){var a=LB.board.generate(LB.pointsPerGeneration,
n[n.length-1],p,LB.direction_towards(n[n.length-2],n[n.length-1]));a.shift();for(l=0;l<a.length;l++)e.appendTournant(a[l].x,a[l].y),n.push(a[l])};r();n.shift();var q=LB.direction_towards(n[0],n[1]),p=cc.p(0,0),m=cc.Sprite.create("res/arrow.png");m.setAnchorPoint(cc.p(.5,0));e.addChild(m);var g=0,t=[[3,0,0,2],[2,1,1,3],[0,2,2,1],[1,3,3,0]],s=[270,90,0,180];m.setRotation(s[q]);for(var u=function(d){0==g&&a.schedule(k,.1);q=t[q][d];m.setRotation(s[q]);p=cc.pAdd(p,LB.board.move[q]);m.setPosition(LB.dataPosToGLPos(p));
e.runAction(cc.EaseSineOut.create(cc.MoveTo.create(.15,cc.pSub(cc.p(b.width/2,b.height/2),LB.dataPosToGLPos(p)))));cc.pEqual(p,e.tournants[++g])?c.setString((10>g?"0":"")+g.toString()):(h.themeColour=cc.color(255,64,64),m.setColor(cc.color(128,128,128)),g--,a.endGame("Ouch!!"));h.appendTournant(p.x,p.y);g%LB.pointsPerGeneration==LB.pointsPerGeneration-LB.board.max_visible_points&&r();return!0},l=0;4>l;l++)this.addChild(LB.control_button(l,u),100,10880+l),this.addChild(LB.control_button_sprite(l),
101)}});cc=cc||{};LB=LB||{};LB.S_if_plural=function(b){return 1<b?"s":""};
LB.rank=[[0,"\u7a7a\u6c14","0%\u751f\u7269","\u6240\u6709\u975e\u751f\u7269"],[1,"\u4e4c\u9f9f","\u8717\u725b"],[1.5,"80%\u975e\u4eba\u7c7b\u52a8\u7269","0%\u7684\u5916\u661f\u4eba"],[2,"90%\u975e\u4eba\u7c7b\u52a8\u7269","30%\u7684\u4eba\u7c7b"],[2.5,"\u4eba\u7c7b\u7684\u5e73\u5747\u901f\u5ea6","\u52a8\u7269\u56ed\u7684\u6240\u6709\u52a8\u7269"],[3,"1%\u7684\u5916\u661f\u4eba","75%\u7684\u4eba\u7c7b","\u81ea\u884c\u8f66\u7ea7\u522b","\u7535\u74f6\u8f66\u7ea7\u522b"],[3.5,"1.5%\u7684\u5916\u661f\u4eba",
"\u6c7d\u8f66\u7ea7\u522b"],[4,"2%\u7684\u5916\u661f\u4eba","\u98de\u673a\u7ea7\u522b","99%\u975e\u4eba\u7c7b\u52a8\u7269"],[5,"\u4f5c\u5f0a\u7684\u5f00\u53d1\u8005","\u706b\u7bad\u7ea7\u522b"],[6,"\u4e25\u91cd\u4f5c\u5f0a\u7684\u5f00\u53d1\u8005","\u884c\u661f\u7ea7\u98de\u8239\u7ea7\u522b","\u5b87\u5b99Line Boost\u5927\u8d5b\u5165\u95e8\u95e8\u69db"],[7,"\u8d85\u7ea7\u4f5c\u5f0a\u7684\u5f00\u53d1\u8005","\u6052\u661f\u7ea7\u98de\u8239\u7ea7\u522b","\u5b87\u5b99Line Boost\u5927\u8d5b\u7b2c100,000,000\u540d"],
[8,"\u661f\u7cfb\u7ea7\u98de\u8239\u7ea7\u522b","\u5b87\u5b99Line Boost\u5927\u8d5b\u7b2c10,000,000\u540d"],[9,"\u5b87\u5b99Line Boost\u5927\u8d5b\u7b2c1,000,000\u540d"],[10,"\u5b87\u5b99Line Boost\u5927\u8d5b\u7b2c50,000\u540d"],[12,"\u5b87\u5b99Line Boost\u5927\u8d5b\u7b2c100\u540d"],[14,"\u5b87\u5b99Line Boost\u5927\u8d5b\u5b63\u519b"],[16,"\u5b87\u5b99Line Boost\u5927\u8d5b\u4e9a\u519b"],[18,"\u5b87\u5b99Line Boost\u5927\u8d5b\u51a0\u519b"]];
LB.GameOverDialogue=cc.LayerColor.extend({title:"",time:0,score:0,speed:0,onEnter:function(){this._super();this.setColor(cc.color(0,0,0,192));var b=cc.director.getWinSize();this.time=this.time.toFixed(2);LB.share_data.time=this.time;LB.share_data.score=this.score;LB.share_data.total_games++;this.speed=0==this.time?0:(this.score/this.time).toFixed(2);for(var a=LB.rank.length-1;0<=a&&!(this.speed>=LB.rank[a][0]);a--);a=LB.rank[a];this.time>=LB.gameTime?(this.rank=a[LB.random(1,
a.length-1)],LB.share_msg="\u6211\u5728Line Boost\u4e2d\u575a\u6301\u5230\u5e95\u5e76\u901a\u8fc7\u4e86"+this.score+"\u4e2a\u70b9\uff0c\u8d85\u8fc7\u4e86"+this.rank+"\uff01\u4f60\u4e5f\u6765\u8bd5\u8bd5\uff1f"):(this.rank="",LB.share_msg="\u6211\u5728Line Boost\u4e2d\u7528"+this.time+"\u79d2\u901a\u8fc7\u4e86"+this.score+"\u4e2a\u70b9\uff0c\u4e0d\u8fc7\u600e\u4e48\u4e5f\u6ca1\u6cd5\u575a\u6301\u5230\u5e95\uff01\u4f60\u4e5f\u6765\u8bd5\u8bd5\uff1f");a=cc.LabelTTF.create(this.title,"",48);a.setPosition(b.width/
2,.9*b.height);a.setColor(cc.color(255,64,64));this.addChild(a);var c=cc.LabelTTF.create("\u6e38\u620f\u7ed3\u675f\uff01\n \n\u8017\u65f6\uff1a\n \n\u5f97\u5206\uff1a\n \n\u5e73\u5747\u901f\u5ea6\uff1a","",30,cc.size(b.width,0));c.setAnchorPoint(cc.p(.5,1));c.setPosition(b.width/2,.85*b.height);this.addChild(c);var d=cc.LabelTTF.create("","",44);d.setPosition(.6*b.width,.67*b.height);d.setVisible(!1);this.addChild(d);var f=cc.LabelTTF.create("","",44);f.setPosition(.6*b.width,.53*b.height);f.setVisible(!1);
this.addChild(f);var k=cc.LabelTTF.create(this.speed+"/s","",36);k.setPosition(.7*b.width,.39*b.height);k.setVisible(!1);this.addChild(k);var e=0,h=function(a){e+=a;2.4<e?(this.unschedule(h),k.setVisible(!0),""==this.rank?c.setString(c.getString()+"\n\u672a\u5b8c\u6210\u6e38\u620f\uff0c\u65e0\u6cd5\u8bc4\u4ef7 T^T"):c.setString(c.getString()+"\n\u8d85\u8fc7\u4e86"+this.rank)):1<e?(a=Math.min(e,1.6)-1,f.setVisible(!0),f.setString((this.score*a).toFixed(0))):(a=Math.min(e,.6),d.setVisible(!0),d.setString((this.time*
a).toFixed(2)+" s"))};this.schedule(h,0);LB.call_php("php/score_stat.php?time="+LB.share_data.time+"&score="+LB.share_data.score+"&total_games="+LB.share_data.total_games);a=cc.MenuItemLabel.create(cc.LabelTTF.create("\u518d\u6765\u4e00\u6b21","",32),function(){cc.director.runScene(cc.TransitionFade.create(1,new LB.GameScene,cc.color(0,0,0)))},this);a.setPosition(b.width/2,.15*b.height);b=cc.Menu.create(a);b.setPosition(cc.p(0,0));this.addChild(b)}});
LB.GameOverDialogue.create=function(b,a,c){var d=new LB.GameOverDialogue;d.time=a;d.score=c;d.title=b;return d};cc=cc||{};LB=LB||{};
LB.TutorialScene=cc.Scene.extend({onEnter:function(){this._super();var b=cc.director.getWinSize(),a=cc.LabelTTF.create("\u73a9\u6cd5","",48);a.setPosition(b.width/2,.85*b.height);this.addChild(a);a=cc.Sprite.create("res/tutorial.png");a.setPosition(cc.p(b.width/2,b.height/2));this.addChild(a);a=cc.LabelTTF.create("You're here","",26);a.setPosition(.3*b.width,.22*b.height);a.setRotation(15);this.addChild(a);cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(a,
b){cc.director.runScene(cc.TransitionFade.create(1,new LB.GameScene,cc.color(0,0,0)));return!0}},this)}});cc=cc||{};LB=LB||{};
LB.board={direction:{LEFT:0,RIGHT:1,UP:2,DOWN:3},turn_direction:[[2,3],[2,3],[0,1],[0,1]],move:[cc.p(-1,0),cc.p(1,0),cc.p(0,1),cc.p(0,-1)],turn_possib:.25,visible_range:cc.p(1.6,2.4),max_visible_points:15,used:[],generate:function(b,a,c,d){var f=[],k=0,e=0;LB.board.used[a.x]&&(LB.board.used[a.x][a.y]=!1);for(var h=function(a,b,d){if(0===a)return!0;if(Math.abs(b.x-c.x)<=LB.board.visible_range.x&&Math.abs(b.y-c.y)<=LB.board.visible_range.y||LB.board.used[b.x]&&LB.board.used[b.x][b.y])if(0<
k)k--;else return!1;var e,m;if(Math.random()<LB.board.turn_possib){var g=LB.random(0,1);e=LB.board.turn_direction[d][g];m=LB.board.turn_direction[d][1-g]}else g=LB.random(0,1),e=d,m=LB.board.turn_direction[d][g],d=LB.board.turn_direction[d][1-g];f.push(b);void 0===LB.board.used[b.x]&&(LB.board.used[b.x]=[]);LB.board.used[b.x][b.y]=!0;if(h(a-1,cc.pAdd(b,LB.board.move[e]),e)||h(a-1,cc.pAdd(b,LB.board.move[m]),m)||h(a-1,cc.pAdd(b,LB.board.move[d]),
d))return!0;f.pop();return!1};!h(b,a,d);)k=++e;return f}};
