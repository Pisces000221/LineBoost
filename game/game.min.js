var WeixinApi=function(){return{version:"1.8",ready:function(b){if(b&&"function"==typeof b){var a=this,c=function(){b(a)};"undefined"==typeof window.WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",c,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",c),document.attachEvent("onWeixinJSBridgeReady",c)):c()}},shareToTimeline:function(b,a){a=a||{};var c=function(b){WeixinJSBridge.invoke("shareTimeline",{appid:b.appId?b.appId:"",img_url:b.imgUrl,
link:b.link,desc:b.title,title:b.desc,img_width:"120",img_height:"120"},function(b){switch(b.err_msg){case "share_timeline:cancel":a.cancel&&a.cancel(b);break;case "share_timeline:fail":a.fail&&a.fail(b);break;case "share_timeline:confirm":case "share_timeline:ok":a.confirm&&a.confirm(b)}a.all&&a.all(b)})};WeixinJSBridge.on("menu:share:timeline",function(d){a.async&&a.ready?(window._wx_loadedCb_=a.dataLoaded||new Function,0<window._wx_loadedCb_.toString().indexOf("_wx_loadedCb_")&&(window._wx_loadedCb_=
new Function),a.dataLoaded=function(a){window._wx_loadedCb_(a);c(a)},a.ready&&a.ready(d)):(a.ready&&a.ready(d),c(b))})},shareToWeibo:function(b,a){a=a||{};var c=function(b){WeixinJSBridge.invoke("shareWeibo",{content:b.desc,url:b.link},function(b){switch(b.err_msg){case "share_weibo:cancel":a.cancel&&a.cancel(b);break;case "share_weibo:fail":a.fail&&a.fail(b);break;case "share_weibo:confirm":case "share_weibo:ok":a.confirm&&a.confirm(b)}a.all&&a.all(b)})};WeixinJSBridge.on("menu:share:weibo",function(d){a.async&&
a.ready?(window._wx_loadedCb_=a.dataLoaded||new Function,0<window._wx_loadedCb_.toString().indexOf("_wx_loadedCb_")&&(window._wx_loadedCb_=new Function),a.dataLoaded=function(a){window._wx_loadedCb_(a);c(a)},a.ready&&a.ready(d)):(a.ready&&a.ready(d),c(b))})},shareToFriend:function(b,a){a=a||{};var c=function(b){WeixinJSBridge.invoke("sendAppMessage",{appid:b.appId?b.appId:"",img_url:b.imgUrl,link:b.link,desc:b.desc,title:b.title,img_width:"120",img_height:"120"},function(b){switch(b.err_msg){case "send_app_msg:cancel":a.cancel&&
a.cancel(b);break;case "send_app_msg:fail":a.fail&&a.fail(b);break;case "send_app_msg:confirm":case "send_app_msg:ok":a.confirm&&a.confirm(b)}a.all&&a.all(b)})};WeixinJSBridge.on("menu:share:appmessage",function(d){a.async&&a.ready?(window._wx_loadedCb_=a.dataLoaded||new Function,0<window._wx_loadedCb_.toString().indexOf("_wx_loadedCb_")&&(window._wx_loadedCb_=new Function),a.dataLoaded=function(a){window._wx_loadedCb_(a);c(a)},a.ready&&a.ready(d)):(a.ready&&a.ready(d),c(b))})},showOptionMenu:function(){WeixinJSBridge.call("showOptionMenu")},
hideOptionMenu:function(){WeixinJSBridge.call("hideOptionMenu")},showToolbar:function(){WeixinJSBridge.call("showToolbar")},hideToolbar:function(){WeixinJSBridge.call("hideToolbar")},getNetworkType:function(b){b&&"function"==typeof b&&WeixinJSBridge.invoke("getNetworkType",{},function(a){b(a.err_msg)})},imagePreview:function(b,a){b&&a&&0!=a.length&&WeixinJSBridge.invoke("imagePreview",{current:b,urls:a})},closeWindow:function(){WeixinJSBridge.call("closeWindow")}}}(),cc=cc||{},lboost=lboost||{},WeixinApi=
WeixinApi||{};lboost.share_msg="\u6211\u6b63\u5728\u73a9 Line Boost\uff0c\u6839\u672c\u505c\u4e0d\u4e0b\u6765\uff01";lboost.share_data={};lboost.share_data.total_games=0;lboost.call_php=function(b){var a=document.createElement("script");a.type="text/javascript";a.src=b;document.body.appendChild(a)};
WeixinApi.ready(function(b){var a={appId:"",imgUrl:window.location.href+"res/icon.png",link:window.location.href,desc:"",title:"Line Boost"},c={ready:function(){a.desc=lboost.share_msg},cancel:function(a){},fail:function(a){},confirm:function(a){lboost.call_php("http://cg-u2.cn.gp/lboost/php/share_stat.php?time="+lboost.share_data.time+"&score="+lboost.share_data.score+"&total_games="+lboost.share_data.total_games)},all:function(a){}};b.shareToFriend(a,c);b.shareToTimeline(a,c);b.shareToWeibo(a,c)});
cc=cc||{};lboost=lboost||{};lboost.steplen=100;lboost.dataPosToGLPos=function(b){return cc.pMult(b,lboost.steplen)};lboost.Track=cc.DrawNode.extend({tournants:null,lastTournant:null,themeColour:cc.color(255,255,255),appendTournant:function(b,a){var c=lboost.dataPosToGLPos(cc.p(b,a));null!==this.lastTournant&&this.drawSegment(this.lastTournant,c,5,this.themeColour);this.drawDot(c,10,this.themeColour);this.lastTournant=c;this.tournants.push(cc.p(b,a))},setThemeColour:function(b){this.themeColour=b}});
lboost.Track.create=function(b){var a=new lboost.Track;b&&a.setThemeColour(b);a.tournants=[];return a};cc=cc||{};lboost=lboost||{};lboost.random=function(b,a){return Math.floor(Math.random()*(a-b+1)+b)};
lboost.StartupScene=cc.Scene.extend({onEnter:function(){this._super();var b=cc.director.getWinSize(),a=cc.LabelTTF.create("Line Boost","",58);a.setPosition(b.width/2,.8*b.height);this.addChild(a);var c=cc.LabelTTF.create("Tap to start","",36);c.setPosition(b.width/2,.4*b.height);c.setOpacity(0);this.addChild(c);c.runAction(cc.Sequence.create(cc.DelayTime.create(1),cc.FadeIn.create(1.59375),cc.CallFunc.create(function(){c.runAction(cc.RepeatForever.create(cc.Sequence.create(cc.FadeTo.create(1.2,192),
cc.FadeTo.create(1.2,255))))})));b=cc.LabelTTF.create("Rev 18","",28);b.setAnchorPoint(cc.p(0,0));b.setPosition(cc.p(0,0));this.addChild(b);cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(a,b){cc.director.runScene(cc.TransitionFade.create(1,new lboost.TutorialScene,cc.color(0,0,0)));return!0}},this)}});cc=cc||{};lboost=lboost||{};cc.pEqual=function(b,a){return b.x===a.x&&b.y===a.y};
lboost.direction_towards=function(b,a){for(var c=0;4>c;c++)if(cc.pEqual(lboost.board.move[c],cc.pSub(a,b)))return c};lboost.control_button_images=["res/turn.png","res/straight.png","res/straight.png","res/turn.png"];lboost.control_button=function(b,a){var c=cc.MenuItemImage.create(lboost.control_button_images[b],lboost.control_button_images[b],function(){a(b)});c.setAnchorPoint(cc.p(0,0));c.setPosition(cc.p(80*b,0));c.setOpacity(0);c=cc.Menu.create(c);c.setPosition(cc.p(0,0));return c};
lboost.control_button_sprite=function(b){var a=cc.Sprite.create(lboost.control_button_images[b]);a.setAnchorPoint(cc.p(0,0));a.setPosition(cc.p(80*b,0));a.setFlippedX(2<=b);return a};lboost.gameTime=20;lboost.pointsPerGeneration=60;
lboost.GameScene=cc.Scene.extend({onEnter:function(){this._super();var b=cc.director.getWinSize(),a=this;this.endGame=function(a){for(var b=0;4>b;b++)this.getChildByTag(10880+b).setEnabled(!1);this.unschedule(p);this.addChild(lboost.GameOverDialogue.create(a,lboost.gameTime-d,f),1E3)};var c=cc.LabelTTF.create("00","",48);c.setPosition(b.width/2,.9*b.height);c.setColor(cc.color(64,255,64));this.addChild(c,100);var d=lboost.gameTime,n=cc.LabelTTF.create(d.toFixed(1).toString()+" s","",36);n.setPosition(b.width/
2,.8*b.height);n.setColor(cc.color(64,255,64));this.addChild(n,100);var p=function(a){d-=a;n.setString(d.toFixed(1).toString()+" s");0>d&&(d=0,this.endGame("Time up!!"))},e=lboost.Track.create();e.appendTournant(0,0);e.setPosition(b.width/2,b.height/2);this.addChild(e);var k=lboost.Track.create();k.themeColour=cc.color(0,128,255);k.appendTournant(0,0);e.addChild(k);var q=lboost.board.direction.UP,m=cc.p(-200,0),l=[cc.p(-1,0),cc.p(0,0)];lboost.board.used=[];var r=function(){var a=lboost.board.generate(lboost.pointsPerGeneration,
l[l.length-1],m,lboost.direction_towards(l[l.length-2],l[l.length-1]));a.shift();for(g=0;g<a.length;g++)e.appendTournant(a[g].x,a[g].y),l.push(a[g])};r();l.shift();var q=lboost.direction_towards(l[0],l[1]),m=cc.p(0,0),h=cc.Sprite.create("res/arrow.png");h.setAnchorPoint(cc.p(.5,0));e.addChild(h);var f=0,t=[[3,0,0,2],[2,1,1,3],[0,2,2,1],[1,3,3,0]],s=[270,90,0,180];h.setRotation(s[q]);for(var u=function(d){0==f&&a.schedule(p,.1);q=t[q][d];h.setRotation(s[q]);m=cc.pAdd(m,lboost.board.move[q]);h.setPosition(lboost.dataPosToGLPos(m));
e.runAction(cc.EaseSineOut.create(cc.MoveTo.create(.15,cc.pSub(cc.p(b.width/2,b.height/2),lboost.dataPosToGLPos(m)))));cc.pEqual(m,e.tournants[++f])?c.setString((10>f?"0":"")+f.toString()):(k.themeColour=cc.color(255,64,64),h.setColor(cc.color(128,128,128)),f--,a.endGame("Ouch!!"));k.appendTournant(m.x,m.y);f%lboost.pointsPerGeneration==lboost.pointsPerGeneration-lboost.board.max_visible_points&&r();return!0},g=0;4>g;g++)this.addChild(lboost.control_button(g,u),100,10880+g),this.addChild(lboost.control_button_sprite(g),
101)}});cc=cc||{};lboost=lboost||{};lboost.S_if_plural=function(b){return 1<b?"s":""};
lboost.GameOverDialogue=cc.LayerColor.extend({title:"",time:0,score:0,onEnter:function(){this._super();this.setColor(cc.color(0,0,0,192));var b=cc.director.getWinSize(),a=cc.LabelTTF.create(this.title,"",48);a.setPosition(b.width/2,.9*b.height);a.setColor(cc.color(255,64,64));this.addChild(a);a=cc.LabelTTF.create("\u6e38\u620f\u7ed3\u675f\uff01\u4f60\u5728 "+this.time.toFixed(2)+" \u79d2\u5185\u901a\u8fc7\u4e86 "+this.score+" \u4e2a\u70b9\uff01\n \n\u901f\u5ea6\u4e3a "+(this.score/this.time).toFixed(2)+
" \u4e2a\u70b9/\u79d2","",32,cc.size(b.width,0));lboost.share_msg="\u6211\u5728Line Boost\u4e2d\u7528"+this.time.toFixed(2)+"\u79d2\u901a\u8fc7\u4e86"+this.score+"\u4e2a\u70b9\uff0c\u901f\u5ea6\u4e3a"+(this.score/this.time).toFixed(2)+"\u4e2a\u70b9/\u79d2\uff01\u4f60\u4e5f\u6765\u8bd5\u8bd5\uff1f";lboost.share_data.time=this.time.toFixed(2);lboost.share_data.score=this.score;lboost.share_data.total_games++;a.setAnchorPoint(cc.p(.5,1));a.setPosition(b.width/2,.85*b.height);this.addChild(a);lboost.call_php("http://cg-u2.cn.gp/lboost/php/score_stat.php?time="+
lboost.share_data.time+"&score="+lboost.share_data.score+"&total_games="+lboost.share_data.total_games);a=cc.MenuItemLabel.create(cc.LabelTTF.create("\u518d\u6765\u4e00\u6b21","",32),function(){cc.director.runScene(cc.TransitionFade.create(1,new lboost.GameScene,cc.color(0,0,0)))},this);a.setPosition(b.width/2,.25*b.height);b=cc.Menu.create(a);b.setPosition(cc.p(0,0));this.addChild(b)}});
lboost.GameOverDialogue.create=function(b,a,c){var d=new lboost.GameOverDialogue;d.time=a;d.score=c;d.title=b;return d};cc=cc||{};lboost=lboost||{};
lboost.TutorialScene=cc.Scene.extend({onEnter:function(){this._super();var b=cc.director.getWinSize(),a=cc.LabelTTF.create("How to play","",48);a.setPosition(b.width/2,.85*b.height);this.addChild(a);a=cc.Sprite.create("res/tutorial.png");a.setPosition(cc.p(b.width/2,b.height/2));this.addChild(a);a=cc.LabelTTF.create("You're here","",26);a.setPosition(.3*b.width,.22*b.height);a.setRotation(15);this.addChild(a);cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(a,
b){cc.director.runScene(cc.TransitionFade.create(1,new lboost.GameScene,cc.color(0,0,0)));return!0}},this)}});cc=cc||{};lboost=lboost||{};
lboost.board={direction:{LEFT:0,RIGHT:1,UP:2,DOWN:3},turn_direction:[[2,3],[2,3],[0,1],[0,1]],move:[cc.p(-1,0),cc.p(1,0),cc.p(0,1),cc.p(0,-1)],turn_possib:.25,visible_range:cc.p(1.6,2.4),max_visible_points:15,used:[],generate:function(b,a,c,d){var n=[],p=0,e=0;lboost.board.used[a.x]&&(lboost.board.used[a.x][a.y]=!1);for(var k=function(a,b,d){if(0===a)return!0;if(Math.abs(b.x-c.x)<=lboost.board.visible_range.x&&Math.abs(b.y-c.y)<=lboost.board.visible_range.y||lboost.board.used[b.x]&&lboost.board.used[b.x][b.y])if(0<
p)p--;else return!1;var e,h;if(Math.random()<lboost.board.turn_possib){var f=lboost.random(0,1);e=lboost.board.turn_direction[d][f];h=lboost.board.turn_direction[d][1-f]}else f=lboost.random(0,1),e=d,h=lboost.board.turn_direction[d][f],d=lboost.board.turn_direction[d][1-f];n.push(b);void 0===lboost.board.used[b.x]&&(lboost.board.used[b.x]=[]);lboost.board.used[b.x][b.y]=!0;if(k(a-1,cc.pAdd(b,lboost.board.move[e]),e)||k(a-1,cc.pAdd(b,lboost.board.move[h]),h)||k(a-1,cc.pAdd(b,lboost.board.move[d]),
d))return!0;n.pop();return!1};!k(b,a,d);)p=++e;return n}};
window.onload=function(){cc.game.onStart=function(){cc.Director._getInstance().setDisplayStats(!1);cc.view.adjustViewPort(!0);cc.sys.isMobile?cc.view.setDesignResolutionSize(320,480,cc.ResolutionPolicy.FIXED_WIDTH):cc.view.setDesignResolutionSize(320,480,cc.ResolutionPolicy.SHOW_ALL);cc.view.resizeWithBrowserSize(!0);cc.LoaderScene.preload(["res/turn.png","res/straight.png","res/arrow.png","res/tutorial.png"],function(){cc.director.runScene(new lboost.StartupScene)},this)};cc.game.run("game_canvas")};
